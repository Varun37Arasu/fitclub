/**
 * Theme CSS Generator
 * 
 * This script generates CSS custom properties from themes.config.js
 * Run this after changing ACTIVE_THEME or DARK_MODE in themes.config.js
 * 
 * Usage: node generate-theme-css.js
 */

import { getActiveTheme, DARK_MODE } from './themes.config.js';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Get the active theme and dark mode setting
const activeTheme = getActiveTheme();
const colors = activeTheme.colors;
const shades = activeTheme.shades || null;
const darkMode = DARK_MODE;

// Define background and text colors based on dark mode
const backgroundColors = darkMode ? {
  primary: '#0f0f0f',    // Nearly black
  secondary: '#1a1a1a',  // Dark gray
  tertiary: '#141414',   // Darker gray
  accent: '#242424',     // Card background
  text: {
    primary: '#ffffff',    // White
    secondary: '#e5e5e5',  // Light gray
    tertiary: '#d1d5db',   // Gray-300
    muted: '#9ca3af',      // Gray-400
  }
} : {
  primary: '#f9fafb',    // Very subtle off-white background
  secondary: '#ffffff',  // Pure white for cards (makes them pop!)
  tertiary: '#f3f4f6',   // Subtle gray for alternate sections
  accent: '#ffffff',     // Pure white for special cards
  text: {
    primary: '#111827',    // Very dark gray (almost black)
    secondary: '#4b5563',  // Gray-600
    tertiary: '#6b7280',   // Gray-500
    muted: '#9ca3af',      // Gray-400
  }
};

// Helper function to convert hex to rgba for shadows/glows
function hexToRgba(hex, alpha = 1) {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  if (!result) return `rgba(0, 0, 0, ${alpha})`;
  
  const r = parseInt(result[1], 16);
  const g = parseInt(result[2], 16);
  const b = parseInt(result[3], 16);
  
  return `rgba(${r}, ${g}, ${b}, ${alpha})`;
}

// Helper function to convert hex to rgb values (for Tailwind opacity support)
function hexToRgb(hex) {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  if (!result) return '0 0 0';
  
  const r = parseInt(result[1], 16);
  const g = parseInt(result[2], 16);
  const b = parseInt(result[3], 16);
  
  return `${r} ${g} ${b}`;
}

// Generate CSS custom properties
const generateThemeCss = () => {
  return `/**
 * THEME CSS VARIABLES - AUTO-GENERATED
 * 
 * DO NOT EDIT THIS FILE DIRECTLY!
 * This file is auto-generated from themes.config.js
 * 
 * Active Theme: ${activeTheme.name}
 * Theme Identity: ${activeTheme.identity}
 * Background Mode: ${darkMode ? 'Dark' : 'Light'}
 * 
 * To change themes or background mode:
 * 1. Update ACTIVE_THEME or DARK_MODE in themes.config.js
 * 2. Run: npm run generate-theme
 * 3. Restart dev server
 */

:root {
  /* ========================================
     BACKGROUND & TEXT COLORS (${darkMode ? 'DARK MODE' : 'LIGHT MODE'})
     ======================================== */
  --bg-primary: ${backgroundColors.primary};
  --bg-primary-rgb: ${hexToRgb(backgroundColors.primary)};
  
  --bg-secondary: ${backgroundColors.secondary};
  --bg-secondary-rgb: ${hexToRgb(backgroundColors.secondary)};
  
  --bg-tertiary: ${backgroundColors.tertiary};
  --bg-tertiary-rgb: ${hexToRgb(backgroundColors.tertiary)};
  
  --bg-accent: ${backgroundColors.accent};
  --bg-accent-rgb: ${hexToRgb(backgroundColors.accent)};
  
  --text-primary: ${backgroundColors.text.primary};
  --text-primary-rgb: ${hexToRgb(backgroundColors.text.primary)};
  
  --text-secondary: ${backgroundColors.text.secondary};
  --text-secondary-rgb: ${hexToRgb(backgroundColors.text.secondary)};
  
  --text-tertiary: ${backgroundColors.text.tertiary};
  --text-tertiary-rgb: ${hexToRgb(backgroundColors.text.tertiary)};
  
  --text-muted: ${backgroundColors.text.muted};
  --text-muted-rgb: ${hexToRgb(backgroundColors.text.muted)};
  
  /* ========================================
     THEME COLORS (RGB format for Tailwind opacity)
     Theme colors work in both dark and light modes
     ======================================== */
  --color-primary: ${colors.primary};
  --color-primary-rgb: ${hexToRgb(colors.primary)};
  --color-primary-hover: ${colors.primaryHover};
  --color-primary-hover-rgb: ${hexToRgb(colors.primaryHover)};
  --color-primary-light: ${colors.primaryLight};
  --color-primary-light-rgb: ${hexToRgb(colors.primaryLight)};
  
  /* ========================================
     SECONDARY COLORS (RGB format for Tailwind opacity)
     ======================================== */
  --color-secondary: ${colors.secondary};
  --color-secondary-rgb: ${hexToRgb(colors.secondary)};
  --color-secondary-hover: ${colors.secondaryHover};
  --color-secondary-hover-rgb: ${hexToRgb(colors.secondaryHover)};
  --color-secondary-light: ${colors.secondaryLight};
  --color-secondary-light-rgb: ${hexToRgb(colors.secondaryLight)};
  
  /* ========================================
     ACCENT COLORS (RGB format for Tailwind opacity)
     ======================================== */
  --color-accent: ${colors.accent};
  --color-accent-rgb: ${hexToRgb(colors.accent)};
  --color-accent-hover: ${colors.accentHover};
  --color-accent-hover-rgb: ${hexToRgb(colors.accentHover)};
  
  /* ========================================
     SEMANTIC COLORS
     ======================================== */
  --color-success: ${colors.success};
  --color-success-rgb: ${hexToRgb(colors.success)};
  --color-warning: ${colors.warning};
  --color-warning-rgb: ${hexToRgb(colors.warning)};
  --color-danger: ${colors.danger};
  --color-danger-rgb: ${hexToRgb(colors.danger)};
  --color-info: ${colors.info};
  --color-info-rgb: ${hexToRgb(colors.info)};
  ${shades ? `
  /* ========================================
     ADVANCED SHADE SYSTEM (Full color scales)
     Available for: ${Object.keys(shades).join(', ')}
     ======================================== */
${Object.entries(shades).map(([shadeName, shadeValues]) => {
  return Object.entries(shadeValues).map(([shadeNumber, hexValue]) => {
    return `  --color-${shadeName}-${shadeNumber}: ${hexValue};
  --color-${shadeName}-${shadeNumber}-rgb: ${hexToRgb(hexValue)};`;
  }).join('\n');
}).join('\n')}
` : ''}
  /* ========================================
     SHADOW & GLOW EFFECTS
     ======================================== */
  --shadow-primary: ${hexToRgba(colors.primary, 0.8)};
  --shadow-primary-light: ${hexToRgba(colors.primary, 0.4)};
  
  --glow-primary-sm: ${hexToRgba(colors.primary, 0.3)};
  --glow-primary-md: ${hexToRgba(colors.primary, 0.5)};
  --glow-primary-lg: ${hexToRgba(colors.primary, 0.4)};
  
  --glow-secondary-sm: ${hexToRgba(colors.secondary, 0.3)};
  --glow-secondary-md: ${hexToRgba(colors.secondary, 0.5)};
  --glow-secondary-lg: ${hexToRgba(colors.secondary, 0.4)};
  
  /* ========================================
     GRADIENT STOPS
     ======================================== */
  --gradient-primary-from: ${colors.primary};
  --gradient-primary-to: ${colors.secondary};
  
  /* ========================================
     BADGE GLOW ANIMATIONS
     ======================================== */
  --badge-glow-start: drop-shadow(0 10px 30px ${hexToRgba(colors.primary, 0.6)}) 
                      drop-shadow(0 0 20px ${hexToRgba(colors.primary, 0.4)})
                      drop-shadow(0 5px 15px rgba(0, 0, 0, 0.8));
                      
  --badge-glow-end: drop-shadow(0 10px 40px ${hexToRgba(colors.primary, 0.9)}) 
                    drop-shadow(0 0 40px ${hexToRgba(colors.primary, 0.7)})
                    drop-shadow(0 5px 20px rgba(0, 0, 0, 0.9));
}

/* ========================================
   NEON TEXT EFFECTS
   ======================================== */
.neon-text {
  text-shadow: 0 0 10px ${hexToRgba(colors.primary, 0.5)},
               0 0 20px ${hexToRgba(colors.primary, 0.3)},
               0 0 30px ${hexToRgba(colors.primary, 0.2)};
}

.neon-box {
  box-shadow: 0 0 15px ${hexToRgba(colors.primary, 0.3)},
              0 0 30px ${hexToRgba(colors.primary, 0.2)};
}
`;
};

// Write to theme-variables.css
const outputPath = path.join(__dirname, 'src', 'theme-variables.css');
const cssContent = generateThemeCss();

try {
  fs.writeFileSync(outputPath, cssContent, 'utf8');
  console.log('‚úÖ Theme CSS generated successfully!');
  console.log(`üìÑ File: ${outputPath}`);
  console.log(`üé® Active Theme: ${activeTheme.name}`);
  console.log(`üéØ Theme Identity: ${activeTheme.identity}`);
  console.log(`${darkMode ? 'üåô' : '‚òÄÔ∏è'}  Background Mode: ${darkMode ? 'Dark' : 'Light'}`);
  console.log('');
  console.log('üí° Restart your dev server to see the changes!');
} catch (error) {
  console.error('‚ùå Error generating theme CSS:', error);
  process.exit(1);
}

